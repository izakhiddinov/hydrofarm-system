# HydroFarm Developer Contract

## 1️⃣ Структура проекта на GitHub

Проект на GitHub: `hydrofarm-system`

hydrofarm-system/
├── backend/ # Python код для работы с Raspberry Pi и ESP32
├── docker/ # Docker-файлы и контейнеры (MQTT, PostgreSQL)
├── docs/
│ ├── schematics/ # Visio и PDF схемы подключения
│ ├── manuals/ # Руководства пользователя
│ └── contracts/ # Контракты и инструкции для разработчиков
├── esp32/ # Код и конфигурации для ESP32
├── web/ # Веб-интерфейс (HTML, CSS, JS)
├── .gitignore
├── LICENSE
└── README.md

yaml
Копировать код

**Примечания:**

- Все изменения в проекте должны фиксироваться через GitHub.
- Каждый новый модуль (ESP32, датчик, насос) добавляется в соответствующую папку и сопровождается документацией в `docs/`.

---

## 2️⃣ Общие правила для разработчиков

1. Все изменения **вносятся через GitHub** с коммитами и описанием.
2. Для крупных изменений используем **ветки (branches)** и pull requests.
3. Каждый разработчик должен согласовывать новые сенсоры и модули в контракте.
4. Все датчики и устройства должны быть описаны в таблице, как в нашем примере для Raspberry Pi и ESP32.

---

## 3️⃣ Подключения и устройства

### Raspberry Pi 5 (основной сервер)

- Отвечает за питание и управление насосами, клапанами, светом и вентиляторами.
- Подключается к ESP32 через Wi-Fi / Ethernet.
- Подключение датчиков и реле:

Пример таблицы для программиста
№ GPIO Название Тип Описание Дополнительная инф. I2C Address
1 21 FLOW_SENSOR_1 INPUT Импульсы расхода воды ACTIVE LOW -
2 26 INLET_VALVE_1 OUTPUT Клапан подачи воды 12V ACTIVE LOW -
3 17 PUMP_1 OUTPUT Насос 1 (основной) ACTIVE LOW -
...
A0 ADS1115 PH_SENSOR ANALOG_INPUT pH-датчик через делитель 10k/10k ADC x2 для реального значения 0x48
A1 ADS1115 TDS_SENSOR ANALOG_INPUT TDS-датчик через делитель 10k/10k ADC x2 для реального значения 0x49
...

markdown
Копировать код

### ESP32 (модули для масштабирования)

- Отвечает за удалённые датчики (I²C, аналоговые, цифровые).
- Таблица для программиста ESP32:

№ GPIO Название Тип Описание Дополнительная инф. I2C Address
1 21 CJMCU-811 I2C CO2 / VOC датчик 3.3V, GND, SDA/SCL 0x5A
2 22 GY-30 I2C Световой датчик BH1750 3.3V, GND, SDA/SCL 0x23
3 34 HW-103 / HW-028 ANALOG_INPUT Влажность почвы 3.3V, GND -
4 4 DHT22 DIGITAL Температура и влажность воздуха 3.3V, GND, DATA -

yaml
Копировать код

---

## 4️⃣ Масштабируемость и новые устройства

- Любой новый датчик / ESP32 модуль:
  1. Создаётся папка в `esp32/` или `backend/`.
  2. Добавляется запись в таблицу подключений.
  3. Все I²C устройства должны иметь уникальный адрес.
- Пользователь должен иметь возможность через веб-интерфейс добавлять новые устройства **без изменения кода вручную**.

---

## 5️⃣ Docker и Backend

- **Docker**:
  - Mosquitto → брокер MQTT для передачи данных от ESP32.
  - PostgreSQL → основная база данных.
- **Backend (Python)**:
  - Считывает данные с Raspberry Pi и ESP32.
  - Обрабатывает сигналы и пишет в БД.
  - Предоставляет API для веб-интерфейса.
- **Web / API (HTML + CSS + JS)**:
  - Отображение данных пользователю.
  - Добавление новых датчиков и устройств.
  - Взаимодействие с Backend через REST или WebSocket.

---

## 6️⃣ Контракт для разработчиков

1. Все файлы должны сохраняться в **соответствующих папках**.
2. Любой новый функционал согласуется с командой.
3. Ветки и Pull Requests используются для согласования изменений.
4. Таблицы подключения датчиков должны быть всегда актуальны.
5. Любой новый модуль I²C или аналоговый датчик:
   - Проверяется на уникальный адрес.
   - Подключение документируется в `docs/schematics/` и в `developer_contract.md`.
6. История изменений хранится через GitHub → каждый разработчик всегда видит, кто и что изменял.

---

## 7️⃣ Пример JSON-конфигурации для нового датчика ESP32

```json
{
  "device_id": "esp32_module_01",
  "sensors": [
    {
      "type": "CJMCU-811",
      "pin": "I2C",
      "i2c_address": "0x5A"
    },
    {
      "type": "GY-30",
      "pin": "I2C",
      "i2c_address": "0x23"
    }
  ]
}
