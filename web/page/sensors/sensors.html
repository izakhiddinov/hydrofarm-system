<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style/all.css">
    <title>Sensors</title>
</head>
<body>
    
    <div class="main">
        <div class="main-block">
            <a class="main-back" href="../../index.html">← Назад</a>
            <p class="main-title">Датчики</p>
        </div>

        <div class="main-container">
            <div class="sensor">
                <div class="sensor-header">
                    <p class="sensor-title">Температура</p>
                    <p class="sensor-zone">Зона 1</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Диапазон</p>
                    <p class="sensor-value">20-23 °C</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Еденица</p>
                    <p class="sensor-value">°C</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Показания</p>
                    <p class="sensor-value current">22 °C</p>
                </div>
            </div>

            <div class="sensor">
                <div class="sensor-header">
                    <p class="sensor-title">Влажность</p>
                    <p class="sensor-zone">Зона 1</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Диапазон</p>
                    <p class="sensor-value">60-80 %</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Еденица</p>
                    <p class="sensor-value">%</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Показания</p>
                    <p class="sensor-value current">66 %</p>
                </div>
            </div>

            <div class="sensor">
                <div class="sensor-header">
                    <p class="sensor-title">Освещение</p>
                    <p class="sensor-zone">Зона 1</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Диапазон</p>
                    <p class="sensor-value">500-700 lux</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Еденица</p>
                    <p class="sensor-value">lux</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Показания</p>
                    <p class="sensor-value current">620 lux</p>
                </div>
            </div>

            <div class="sensor">
                <div class="sensor-header">
                    <p class="sensor-title">Воздух</p>
                    <p class="sensor-zone">Зона 1</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Диапазон</p>
                    <p class="sensor-value">800 - 1500 co2</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Еденица</p>
                    <p class="sensor-value">co2</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Показания</p>
                    <p class="sensor-value current">1200 co2</p>
                </div>
            </div>

            <div class="sensor">
                <div class="sensor-header">
                    <p class="sensor-title">Уровень воды</p>
                    <p class="sensor-zone">Зона 1</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Диапазон</p>
                    <p class="sensor-value">80-100 %</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Еденица</p>
                    <p class="sensor-value">%</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Показания</p>
                    <p class="sensor-value current">90 %</p>
                </div>
            </div>

            <div class="sensor">
                <div class="sensor-header">
                    <p class="sensor-title">Давление воды</p>
                    <p class="sensor-zone">Зона 1</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Диапазон</p>
                    <p class="sensor-value">3-5 bar</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Еденица</p>
                    <p class="sensor-value">bar</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Показания</p>
                    <p class="sensor-value current">4.5 bar</p>
                </div>
            </div>

            <div class="sensor">
                <div class="sensor-header">
                    <p class="sensor-title">Температура воды</p>
                    <p class="sensor-zone">Зона 1</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Диапазон</p>
                    <p class="sensor-value">20-23 °C</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Еденица</p>
                    <p class="sensor-value">°C</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Показания</p>
                    <p class="sensor-value current">22 °C</p>
                </div>
            </div>

            <div class="sensor">
                <div class="sensor-header">
                    <p class="sensor-title">pH</p>
                    <p class="sensor-zone">Зона 1</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Диапазон</p>
                    <p class="sensor-value">5-7 pH</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Еденица</p>
                    <p class="sensor-value">pH</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Показания</p>
                    <p class="sensor-value current">6 pH</p>
                </div>
            </div>

            <div class="sensor">
                <div class="sensor-header">
                    <p class="sensor-title">TDS</p>
                    <p class="sensor-zone">Зона 1</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Диапазон</p>
                    <p class="sensor-value">400-700 tds</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Еденица</p>
                    <p class="sensor-value">tds</p>
                </div>

                <div class="sensor-row">
                    <p class="sensor-label">Показания</p>
                    <p class="sensor-value current">500 tds</p>
                </div>
            </div>

        </div>
    </div>

</body>
</html>

<script>
    const ws = new WebSocket("ws://<Raspberry_IP>:8000/ws"); // замени на IP Raspberry Pi

    ws.onopen = () => console.log("WebSocket connected");
    ws.onclose = () => console.log("WebSocket disconnected");

    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);

        // data = { "AA:BB:CC:DD:EE:FF": { temperature: 22, humidity: 66, ... }, ... }
        for (const node_id in data) {
            const node = data[node_id];

            // Пробегаемся по сенсорам на странице
            document.querySelectorAll(".sensor").forEach(sensorDiv => {
                const titleEl = sensorDiv.querySelector(".sensor-title");
                const currentEl = sensorDiv.querySelector(".sensor-value.current");

                if (!titleEl || !currentEl) return;

                const title = titleEl.textContent.toLowerCase();

                // Проверяем, какой сенсор обновлять
                if (title.includes("температура") && node.temperature !== undefined) {
                    currentEl.textContent = node.temperature + " °C";
                }
                else if (title.includes("влажность") && node.humidity !== undefined) {
                    currentEl.textContent = node.humidity + " %";
                }
                else if (title.includes("освещение") && node.light !== undefined) {
                    currentEl.textContent = node.light + " lux";
                }
                else if (title.includes("воздух") && node.co2 !== undefined) {
                    currentEl.textContent = node.co2 + " co2";
                }
                else if (title.includes("уровень воды") && node.water_level !== undefined) {
                    currentEl.textContent = node.water_level + " %";
                }
                else if (title.includes("давление воды") && node.water_pressure !== undefined) {
                    currentEl.textContent = node.water_pressure + " bar";
                }
                else if (title.includes("температура воды") && node.water_temperature !== undefined) {
                    currentEl.textContent = node.water_temperature + " °C";
                }
                else if (title.includes("ph") && node.ph !== undefined) {
                    currentEl.textContent = node.ph + " pH";
                }
                else if (title.includes("tds") && node.tds !== undefined) {
                    currentEl.textContent = node.tds + " tds";
                }

                // Можно добавить другие сенсоры по необходимости
            });
        }
    };
</script>
